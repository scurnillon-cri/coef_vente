<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Calculateur de Coefficient de Vente - CRI</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
    body {
        background: #f5f7fa;
        font-family: "Inter", system-ui, sans-serif;
    }

    h1, h2, h3 {
        font-weight: 700;
    }

    .card {
        border-radius: 14px;
        border: none;
        box-shadow: 0 4px 14px rgba(0,0,0,0.08);
    }

    .card-header {
        font-size: 1.15rem;
        font-weight: 600;
        border-radius: 14px 14px 0 0 !important;
    }

    /* Barre de comp√©titivit√© */
    .progress {
        height: 18px;
        border-radius: 20px;
        overflow: hidden;
    }

    #competitiviteTexte {
        font-size: 1.25rem;
        font-weight: 600;
        line-height: 1.4;
    }

    /* Header premium */
    .cri-header {
        background: #ffffff;
        border-radius: 14px;
        box-shadow: 0 4px 18px rgba(0,0,0,0.08);
    }

    .cri-logo {
        max-height: 80px;
    }

    @media (max-width: 768px) {
        .cri-logo {
            max-height: 60px;
        }
    }
</style>
</head>

<body class="p-3">

<div class="container">

    <!-- HEADER AVEC LOGO CRI -->
    <div class="cri-header d-flex flex-column flex-md-row align-items-center justify-content-between px-4 py-3 mb-4">
        <img src="logo_cri.png" alt="CRI" class="cri-logo">
        <h1 class="text-center text-md-end mt-3 mt-md-0">
            Calculateur de Coefficient de Vente
        </h1>
    </div>

    <!-- Prix Public -->
    <div class="card mb-4">
        <div class="card-header bg-dark text-white">Prix Public</div>
        <div class="card-body">
            <label class="form-label">Prix Public (‚Ç¨)</label>
            <input type="number" id="prixPublic" class="form-control" value="500" oninput="updateAll()">
        </div>
    </div>

    <!-- AVANT / APR√àS -->
    <div class="row g-4">

        <!-- AVANT -->
        <div class="col-lg-6">
            <div class="card h-100">
                <div class="card-header bg-primary text-white">Avant</div>
                <div class="card-body">

                    <label class="form-label">Remise (%)</label>
                    <input type="number" id="remiseAvant" class="form-control" oninput="updateAll()">

                    <label class="form-label mt-3">Prix d'achat (‚Ç¨)</label>
                    <input type="number" id="achatAvant" class="form-control" readonly>

                    <label class="form-label mt-3">Coef de vente</label>
                    <input type="number" id="coefAvant" step="0.01" class="form-control" oninput="updateAll()">

                    <label class="form-label mt-3">Prix de vente (‚Ç¨)</label>
                    <input type="number" id="venteAvant" class="form-control" readonly>

                    <label class="form-label mt-3">Marge (‚Ç¨)</label>
                    <input type="number" id="margeAvant" class="form-control" readonly>

                </div>
            </div>
        </div>

        <!-- APR√àS -->
        <div class="col-lg-6">
            <div class="card h-100">
                <div class="card-header bg-success text-white">Apr√®s</div>
                <div class="card-body">

                    <label class="form-label">Nouvelle Remise (%)</label>
                    <input type="number" id="remiseApres" class="form-control" oninput="updateAll()">

                    <label class="form-label mt-3">Nouveau Prix d'achat (‚Ç¨)</label>
                    <input type="number" id="achatApres" class="form-control" readonly>

                    <label class="form-label mt-3">Nouveau Coef de vente</label>
                    <div class="input-group">
                        <input type="number" id="coefApres" step="0.01" class="form-control" oninput="updateAll()">
                        <button class="btn btn-outline-primary" onclick="calcCoefEqualGain()">= Gain Avant</button>
                    </div>

                    <label class="form-label mt-3">Nouveau Prix de vente (‚Ç¨)</label>
                    <input type="number" id="venteApres" class="form-control" readonly>

                    <label class="form-label mt-3">Nouvelle Marge (‚Ç¨)</label>
                    <input type="number" id="margeApres" class="form-control" readonly>

                    <label class="form-label mt-3">Gain (%)</label>
                    <input type="number" id="gainPourcent" class="form-control" readonly>

                </div>
            </div>
        </div>
    </div>

    <!-- R√âSULTAT -->
    <div class="card mt-4">
        <div class="card-header bg-info text-white">R√©sultat de Comp√©titivit√©</div>
        <div class="card-body">

            <p id="competitiviteTexte" class="text-center mb-4"></p>

            <div class="progress">
                <div id="competitiviteBarre" class="progress-bar bg-secondary" style="width: 0%"></div>
            </div>

        </div>
    </div>

</div>


<!-- JAVASCRIPT -->
<script>

/* ========= CALCUL PRINCIPAL ========= */

function updateAll() {
    const prix = parseFloat(document.getElementById("prixPublic").value);

    // Avant
    const remiseA = parseFloat(document.getElementById("remiseAvant").value || 0);
    const coefA = parseFloat(document.getElementById("coefAvant").value || 0);

    const achatA = prix * (1 - remiseA / 100);
    const venteA = achatA * coefA;
    const margeA = venteA - achatA;

    document.getElementById("achatAvant").value = achatA.toFixed(2);
    document.getElementById("venteAvant").value = venteA.toFixed(2);
    document.getElementById("margeAvant").value = margeA.toFixed(2);

    // Apr√®s
    const remiseB = parseFloat(document.getElementById("remiseApres").value || 0);
    const coefB = parseFloat(document.getElementById("coefApres").value || 0);

    const achatB = prix * (1 - remiseB / 100);
    const venteB = achatB * coefB;
    const margeB = venteB - achatB;

    document.getElementById("achatApres").value = achatB.toFixed(2);
    document.getElementById("venteApres").value = venteB.toFixed(2);
    document.getElementById("margeApres").value = margeB.toFixed(2);

    // Gain %
    const gain = ((venteB / venteA) - 1) * 100;
    document.getElementById("gainPourcent").value = gain.toFixed(2);

    updateCompetitivite();
}



/* ========= BOUTON = GAIN AVANT ========= */

function calcCoefEqualGain() {
    const achatA = parseFloat(document.getElementById("achatAvant").value);
    const venteA = parseFloat(document.getElementById("venteAvant").value);
    const margeA = venteA - achatA;

    const achatB = parseFloat(document.getElementById("achatApres").value);

    const venteBExact = achatB + margeA;
    const coefExact = venteBExact / achatB;

    document.getElementById("venteApres").value = venteBExact.toFixed(2);
    document.getElementById("coefApres").value = coefExact.toFixed(2);
    document.getElementById("margeApres").value = margeA.toFixed(2);

    updateAll();
}



/* ========= MESSAGE COMMERCIAL PREMIUM ========= */

function updateCompetitivite() {

    const venteA = parseFloat(document.getElementById("venteAvant").value);
    const venteB = parseFloat(document.getElementById("venteApres").value);
    const margeA = parseFloat(document.getElementById("margeAvant").value);
    const margeB = parseFloat(document.getElementById("margeApres").value);

    const texte = document.getElementById("competitiviteTexte");
    const barre = document.getElementById("competitiviteBarre");

    if (!venteA || !venteB) return;

    const varPrix = ((venteB / venteA) - 1) * 100;
    const varMarge = ((margeB / margeA) - 1) * 100;

    const absPrix = Math.abs(varPrix).toFixed(2);
    const absMarge = Math.abs(varMarge).toFixed(2);

    let msg = "";
    let color = "bg-secondary";
    let emoji = "";

    if (Math.abs(varMarge) < 0.01 && varPrix < 0) {
        emoji = "üü¢";
        color = "bg-success";
        msg = `${emoji} M√™me marge. Prix plus bas de <b>${absPrix}%</b>.<br>Vous devenez instantan√©ment plus comp√©titif.`;
    }
    else if (Math.abs(varMarge) < 0.01 && varPrix > 0) {
        emoji = "üü†";
        color = "bg-warning";
        msg = `${emoji} Votre marge reste identique, mais votre prix augmente de <b>${absPrix}%</b>.<br>Attention √† la comp√©titivit√©.`;
    }
    else if (varMarge > 0 && varPrix < 0) {
        emoji = "üåü";
        color = "bg-success";
        msg = `${emoji} Vous am√©liorez votre marge de <b>${absMarge}%</b> tout en baissant votre prix de <b>${absPrix}%</b>.<br>C‚Äôest le sc√©nario id√©al : plus rentable ET plus comp√©titif.`;
    }
    else if (varMarge > 0 && varPrix > 0) {
        emoji = "‚öñÔ∏è";
        color = "bg-info";
        msg = `${emoji} Votre marge augmente de <b>${absMarge}%</b>, mais votre prix progresse aussi de <b>${absPrix}%</b>.<br>Vous gagnez en rentabilit√© mais perdez en comp√©titivit√©.`;
    }
    else if (varMarge < 0 && varPrix < 0) {
        emoji = "üîµ";
        color = "bg-primary";
        msg = `${emoji} Prix plus attractif (<b>-${absPrix}%</b>), mais marge en retrait (<b>-${absMarge}%</b>).<br>√Ä utiliser comme levier strat√©gique.`;
    }

    texte.innerHTML = msg;

    let perf = (-varPrix + varMarge);
    perf = Math.min(Math.abs(perf), 100);

    barre.className = "progress-bar " + color;
    barre.style.width = perf + "%";
}

updateAll();
</script>

</body>
</html>
